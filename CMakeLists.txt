cmake_minimum_required(VERSION 3.10)

project(sfm LANGUAGES CXX)
set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set (PSP_VERSION_MAJOR 1)
option(USE_EIGEN3 "USE Eigen3 Library" OFF)
option(USE_PYTHON "USE Python Library" OFF)
if(USE_EIGEN3)
    find_package(Eigen3 CONFIG REQUIRED)
    set(USE_EIGEN3_LIB 1)
else()
    set(USE_EIGEN3_LIB 0)
endif()
configure_file (
  "${PROJECT_SOURCE_DIR}/core/config.h.in"
  "${PROJECT_BINARY_DIR}/config.h"
  )

include_directories(${PROJECT_SOURCE_DIR})
include_directories(${PROJECT_BINARY_DIR})
if(USE_EIGEN3)
    find_package(Eigen3 CONFIG REQUIRED)
endif()

add_executable(main main.cpp)
if(USE_EIGEN3)
    target_link_libraries(main PRIVATE Eigen3::Eigen)
endif()
if(USE_PYTHON)
    find_package(PythonLibs)
    add_library(psp SHARED ${PROJECT_SOURCE_DIR}/core/python/psp.cpp)
    target_include_directories(psp PUBLIC ${PYTHON_INCLUDE_DIR})    
endif()
option(ENABLE_TESTING "Enable testing" ON)
if(ENABLE_TESTING)
  find_package(GTest REQUIRED)
  include(CTest)
  add_subdirectory(test)
endif()